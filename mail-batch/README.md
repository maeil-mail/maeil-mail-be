## memo

- 일간 메일 발송
    - (reader or processor): 일간 구독자를 읽어온다. -> Jpa or Jdbc Paging Item Reader
        - 유효 데이터(아래 조건을 모두 충족해야 한다.) :
            - deleted_at이 7시 이후
            - null인 구독자 레코드
            - DAILY 전송 주기를 가진 사람
            - created_at이 발송일 7시 이전인 경우
        - 엣지 케이스 : 오전 7시 1분에 발송 주기를 변경하는 사용자는 어떻게 처리할 것인가?
            - 기존 : 오전 7시 데이터를 스냅샷을 찍어서 사용한다.
            - 대안 : 
              - cursor을 사용하는 방식
              - updated_at을 기준으로 수정? 
                - ex) processor에서 updated_at이 오전 7시 이후인 경우, 전송 주기 체크하여 처리 
                - 위 방식의 경우, DAILY라면 보낼지 보내지 않을지?를 결정해야 한다.
                  - 만약, 보내지 않는다를 가정하면 7시 이후에 수정하는 것을 시스템이 용인하는 것인가? 그러면 발송 과정 중에 구독하는 경우도 전달 해야하지 않는가?
    - (processor or writer) 일간 구독자에 대한 메일을 생성한다.
        - I chunk가 subscribe면, O chunk가 mailMessage로 만듦? 필요한 데이터는 프로세서에서 DB 콜 해야하나? -> 청크만큼 반복 조회?
        - choice question policy 사용하면 됨
        - 고민 필요한 부분 : 로컬 캐시 사용 여부
    - (writer - 청크 단위 처리가 효율적) 받은 질문지 내역을 추가한다.
        - 과거에 받았던 질문지 내역을 제거하고, 새로운 질문지 내역을 추가한다.
        - 고민 필요한 부분 : n + 1 및 삭제 처리 시 효율성 고려
    - (흠.. 이건 뭘까) 메일을 발송한다.
    - (tasklet) 일간 구독자의 시퀀스를 1씩 증가시킨다.
    - (tasklet) 관리자에게 발송 내역을 전송한다.
